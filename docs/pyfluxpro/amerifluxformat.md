# Documentation on amerifluxformat module
Document is a code walk-through on pyfluxpro/amerifluxformat.py module

## Overview
- The [amerifluxformat](https://github.com/ncsa/ameriflux-pipeline/blob/develop/ameriflux_pipeline/pyfluxpro/amerifluxformat.py) process creates the pyfluxpro input excel sheet for the Ameriflux processing.
- The module creates pyfluxpro input excel sheet with the output from [pyfluxproformat](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/pyfluxpro/pyfluxproformat.md) process.
- This excel sheet is used as input for the PyFluxPro software. 
- The pipeline calls this process in [step#13](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/prepyfluxpro.md#13) of pre-pyfluxpro module, after the [runeddypro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/eddypro/runeddypro.md) process.

## Instructions to run

### Using the GUI
- There is an option to run this module independently. 
- This can be achieved using the [pipeline.py](https://github.com/ncsa/ameriflux-pipeline/blob/develop/ameriflux_pipeline/pipeline.py) GUI and clicking the "Run" button in the "Run PyFluxPro data preparation" section.

### Using the command line
- Running ```python pre_pyfluxpro.py``` will execute this process along with other modules within [pre_pyfluxpro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/prepyfluxpro.md) module.

## Process

### 1
- This process takes the output generated by the [pyfluxproformat](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/pyfluxpro/pyfluxproformat.md) module as input.

### 2
- Unit changes and name changes for selected variables in the full_output and met_data sheet are done.
- Albedo column is renamed as ALB and unit is converted to percentage.
- VPD column unit is changed to hPa.
- The TAU column values are sign reversed (multiplied by -1.0) and unit changed to 'kg+1m-1s-2'.
- All soil mositure variables are converted to percentage values.
- Variances are converted to standard deviations in full_output sheet and units are changed from 'm+2s-2' to 'm+1s-1' and from 'K+2' to 'K'.

### 3
- The formatted sheets are written to an excel sheet specified by the user in enveditor settings(PYFLUXPRO_INPUT_AMERIFLUX).