# Documentation on post-pyfluxpro
This document will describe the post_pyfluxpro.py module.

## Overview
- This module creates Ameriflux submission-ready csv file with filename 'US-Ui<ameriflux_site_name>_HH_<start_time>_<end_time>
- This is typically the last step in the pipeline, executed after runnning the PyFluxPro software and after the technician is satisfied with the generated plots.
- The module uses the settings from .env file generated by [enveditor](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/enveditor.md) module.
- All logs are recorded in the log file named post_pyfluxpro.log.

## Instructions to run

## Using GUI
- Please run command ```python pipeline.py```.
- On launch of GUI, click "Run" button under the "Post-Pyfluxpro Process".
- Make sure all required settings / files are present.
- The required settings are read from .env file.

### Using command line
- Please run using command ```python post_pyfluxpro.py```.
- The settings are read from .env file.

## Process
- [post_pyfluxpro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/ameriflux_pipeline/post_pyfluxpro.py) module is typically the last step in the pipeline, executed after runnning the PyFluxPro software.

### 1
- The ```run()``` method is called first which starts the post_pyfluxpro module.
- [pyfluxpro_output_ameriflux_processing()](https://github.com/ncsa/ameriflux-pipeline/blob/develop/ameriflux_pipeline/post_pyfluxpro.py#L26) method is called with these inputs :
  - L2_AMERIFLUX_RUN_OUTPUT 
    - User input filepath (.nc) where the pyfluxpro L2 run output is written.
  - file_meta_data_file 
    - The file containing the file-level meta data of meteorological data. 
    - This file is created in step#6 of [pre_pyfluxpro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/prepyfluxpro.md) module.
    - AMERIFLUX_VARIABLE_USER_CONFIRMATION
      - Described in step#3 of [pre_pyfluxpro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/prepyfluxpro.md) module.
    - L1_AMERIFLUX_ERRORING_VARIABLES_KEY
      - Described in step#3 of [pre_pyfluxpro](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/prepyfluxpro.md) module.

### 2
- pyfluxpro_output_ameriflux_processing() method calls the [outputformat](https://github.com/ncsa/ameriflux-pipeline/blob/develop/docs/pyfluxpro/outputformat.md) module with these input parameters.
- Outputformat module creates the ameriflux-ready data and ameriflux-filename.
- pyfluxpro_output_ameriflux_processing() method write the ameriflux-ready data to a csv file with ameriflux-filename.
- If creation of ameriflux-file is unsuccessful, an error message is logged and process aborted.

### 3
- If creation of ameriflux submission-ready csv file is successfull, post_pyfluxpro module is completed and processes ended.
- Logs can be found in file post_pyfluxpro.log.